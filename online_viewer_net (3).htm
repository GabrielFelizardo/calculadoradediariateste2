<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Diária</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { 
            --azul-marinho: #191970; 
            --roxo: #4B0082; 
            --azul-texto: #1e3b8a;
            --laranja: #e67e22; 
            --branco: #ffffff; 
            --cinza-claro: #f5f5f5; 
            --cinza-medio: #e0e0e0; 
            --cinza-escuro: #6c757d; 
            --verde: #27ae60; 
            --vermelho: #e74c3c; 
            --sombra: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', sans-serif; background-color: var(--cinza-claro); color: #333; line-height: 1.6; padding: 20px; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(to right, var(--azul-marinho), var(--roxo)); color: white; padding: 20px; box-shadow: var(--sombra); border-radius: 8px 8px 0 0; margin-bottom: 20px; }
        .header-content { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;}
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo i { font-size: 32px; color: white; }
        .logo-text { display: flex; flex-direction: column; }
        .logo-text h1 { font-size: 24px; font-weight: 700; margin: 0; }
        .logo-text p { font-size: 14px; opacity: 0.9; margin: 0; }
        .header-actions { display: flex; align-items: center; gap: 20px; }
        .dolar-info { background: rgba(0,0,0,0.2); padding: 10px 15px; border-radius: 6px; text-align: center; }
        .dolar-info .label { font-size: 12px; opacity: 0.8; }
        .dolar-info .value { font-size: 18px; font-weight: 700; }
        .card { background: var(--branco); border-radius: 8px; box-shadow: var(--sombra); overflow: hidden; margin-bottom: 20px; }
        .card-header { background: var(--azul-marinho); color: white; padding: 12px 20px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .card-body { padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 992px) { .grid { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--azul-texto); font-size: 14px; }
        select, input { width: 100%; padding: 10px 12px; border: 1px solid var(--cinza-medio); border-radius: 4px; font-family: 'Open Sans', sans-serif; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th { background-color: var(--azul-marinho); color: white; text-align: left; padding: 10px 12px; font-weight: 600; }
        td { padding: 10px 12px; border-bottom: 1px solid var(--cinza-medio); }
        .total-row { font-weight: 700; background-color: #e8f4f8 !important; }
        .total-row td:last-child { color: var(--verde); font-size: 15px; }
        .help-text { font-size: 12px; color: var(--cinza-escuro); margin-top: 5px; display: block; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid var(--azul-marinho); }
        .tab { padding: 12px 20px; background: var(--cinza-claro); cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 5px; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; color: var(--azul-texto);}
        .tab.active { background: linear-gradient(to right, var(--azul-marinho), var(--roxo)); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .preview-block { background-color: #eef2f7; padding: 20px; border-radius: 8px; border: 1px dashed var(--azul-medio); }
        .preview-block h4 { color: var(--azul-marinho); border-bottom: 1px solid var(--cinza-medio); padding-bottom: 8px; margin-bottom: 10px; font-size: 15px; }
        .preview-grid { display: grid; grid-template-columns: 150px 1fr; gap: 8px 15px; font-size: 14px; margin-bottom: 15px; }
        .preview-grid strong { color: #333; }
        .preview-grid span { color: var(--azul-texto); font-weight: 600; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--azul-claro); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        .action-button { color: white; border: none; padding: 10px 15px; border-radius: 5px; font-weight: 600; cursor: pointer; }
        .action-button i { margin-right: 8px; }
        .actions-container { text-align: right; padding-top: 20px; border-top: 1px solid var(--cinza-medio); margin-top: 20px; }
        footer { text-align: center; padding: 20px 0; font-size: 12px; color: var(--cinza-escuro); }
        @media print {
            body * { visibility: hidden; }
            #preview-to-export, #preview-to-export * { visibility: visible; }
            #preview-to-export { position: absolute; left: 0; top: 0; width: 100%; border: none !important; padding: 0 !important; background-color: white !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
             <div class="header-content">
                <div class="logo"><i class="fas fa-globe-americas"></i><div class="logo-text"><h1>Calculadora de Diária</h1><p>Decreto nº 46.611/2019</p></div></div>
                <div class="header-actions">
                    <button id="toggle-info-btn" class="action-button" style="background-color: var(--cinza-escuro); font-size: 12px;"><i class="fas fa-user-plus"></i> Adicionar Info. do Viajante</button>
                    <div class="dolar-info"><div class="label">COTAÇÃO DO DÓLAR</div><div class="value" id="dolar-value">...</div></div>
                </div>
            </div>
        </div>
        <div class="card" id="info-solicitacao-card" style="display: none;">
            <div class="card-header"><i class="fas fa-user-edit"></i>Informações da Solicitação</div>
            <div class="card-body">
                 <div class="grid" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="form-group"><label for="simulador-nome">Calculado por:</label><input type="text" id="simulador-nome"></div>
                    <div class="form-group"><label for="viajante-nome">Nome do Viajante:</label><input type="text" id="viajante-nome"></div>
                    <div class="form-group"><label for="viajante-id">ID Funcional / Matrícula:</label><input type="text" id="viajante-id"></div>
                </div>
                <div class="grid" style="grid-template-columns: 1fr 1fr 1fr;">
                     <div class="form-group"><label for="viajante-banco">Banco:</label><input type="text" id="viajante-banco"></div>
                    <div class="form-group"><label for="viajante-agencia">Agência:</label><input type="text" id="viajante-agencia"></div>
                    <div class="form-group"><label for="viajante-conta">Conta Corrente:</label><input type="text" id="viajante-conta"></div>
                </div>
            </div>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="openTab('nacional')">Viagem Nacional</div>
            <div class="tab" onclick="openTab('internacional')">Viagem Internacional</div>
        </div>
        <div id="nacional" class="tab-content active">
             <div class="card"><div class="card-body" id="calculator-nac-body"><div class="loading-spinner"></div></div></div>
        </div>
        <div id="internacional" class="tab-content">
             <div class="card"><div class="card-body" id="calculator-int-body"><div class="loading-spinner"></div></div></div>
        </div>
        <div class="card">
            <div class="card-header"><i class="fas fa-eye"></i>Pré-Visualização do Relatório</div>
            <div class="card-body">
                <div class="preview-block" id="preview-to-export">
                    <div id="preview-dados-viajante" style="display:none;">
                        <h4>Dados do Viajante</h4>
                        <div class="preview-grid">
                            <strong>Calculado por:</strong> <span id="preview-simulador-nome"></span>
                            <strong>Nome do Viajante:</strong> <span id="preview-viajante-nome"></span>
                            <strong>ID Funcional:</strong> <span id="preview-viajante-id"></span>
                            <strong>Dados Bancários:</strong> <span id="preview-dados-bancarios"></span>
                        </div>
                    </div>
                    <h4>Parâmetros do Cálculo</h4>
                    <div class="preview-grid">
                        <strong>Tipo de Viagem:</strong> <span id="preview-tipo-viagem"></span>
                        <strong>Grupo:</strong> <span id="preview-grupo"></span>
                        <strong>Localidade:</strong> <span id="preview-localidade"></span>
                        <strong id="label-cotacao">Cotação do Dólar:</strong> <span id="preview-cotacao"></span>
                        <strong id="label-data-calculo">Data do Cálculo:</strong> <span id="preview-data-calculo"></span>
                    </div>
                    <h4>Detalhamento dos Custos</h4>
                    <div class="preview-grid">
                        <strong id="label-alimentacao">Total Alimentação:</strong> <span id="preview-total-alimentacao"></span>
                        <strong id="label-pousada">Total Pousada:</strong> <span id="preview-total-pousada"></span>
                        <strong id="label-diaria-int">Diária Completa:</strong> <span id="preview-total-diaria-int"></span>
                        <strong>Total Translado:</strong> <span id="preview-total-translado"></span>
                        <strong>VALOR TOTAL GERAL:</strong> <span id="preview-total-geral" style="font-size: 16px;"></span>
                    </div>
                </div>
                <div class="actions-container">
                    <button class="action-button" onclick="imprimirPreview()" style="background-color: var(--azul-claro);"><i class="fas fa-print"></i> Imprimir / Salvar PDF</button>
                    <button class="action-button" onclick="gerarTXT()" style="background-color: var(--laranja); margin-left:10px;"><i class="fas fa-file-alt"></i> Gerar TXT</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        Desenvolvido por: Gabriel Felizardo da Silva
    </footer>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwaqI-FnI29vTMwYXxQeTViw1F-YPsl4yo1C9_9tAJDYkjuCy-dbQ_Z425ceJvdoJ8uwg/exec";
        let dolarRate = 5.50;
        let valoresNacionais = {}, valoresInternacionais = {}, configValores = {};
        let timestampCalculo = '';
        
        async function carregarTodosOsValores() {
            document.body.style.cursor = 'wait';
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Falha na resposta da rede.');
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                valoresNacionais = data.nacional || {};
                valoresInternacionais = data.internacional || {};
                configValores = data.config || {};
            } catch (error) {
                console.error("Erro ao carregar dados da planilha:", error);
                alert(`Não foi possível carregar os valores da planilha. A aplicação pode não funcionar corretamente.\nErro: ${error.message}`);
            } finally {
                document.body.style.cursor = 'default';
            }
        }

        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            atualizarPreview();
        }

        async function fetchDolarRate() {
            try {
                const r = await fetch('https://open.er-api.com/v6/latest/USD');
                const d = await r.json();
                dolarRate = parseFloat(d.rates.BRL);
                document.getElementById('dolar-value').textContent = `R$ ${dolarRate.toFixed(2)}`;
                if (document.getElementById('internacional').classList.contains('active')) {
                    calcularValoresInternacionais();
                }
            } catch (e) {
                document.getElementById('dolar-value').textContent = 'Erro';
            }
        }
        
        async function fetchHoraAtual() {
            try {
                const response = await fetch('https://worldtimeapi.org/api/ip');
                if (!response.ok) throw new Error('API de hora falhou.');
                const data = await response.json();
                const dataHora = new Date(data.datetime);
                timestampCalculo = dataHora.toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'medium' });
            } catch (e) {
                console.error("Erro ao buscar hora da API:", e);
                timestampCalculo = new Date().toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'medium' }) + " (horário do sistema)";
            }
        }

        function calcularValoresNacionais() {
            if (!document.getElementById('grupo')) return; 
            const g = document.getElementById('grupo').value, c = document.getElementById('cidade').value;
            const d = parseInt(document.getElementById('diarias').value) || 0, p = parseInt(document.getElementById('pernoites').value) || 0, t = parseInt(document.getElementById('translados').value) || 0;
            let vA = 0, vP = 0;
            const vT = configValores.translado_nacional || 44.00;
            if (g && c && valoresNacionais[c] && valoresNacionais[c][g]) { vA = valoresNacionais[c][g].alimentacao; vP = valoresNacionais[c][g].pousada; }
            const tA = d * vA, tP = p * vP, tT = t * vT, tG = tA + tP + tT;
            const f = (n, c = '') => `${c}${n.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('qtd-alimentacao').textContent = d;
            document.getElementById('qtd-pousada').textContent = p;
            document.getElementById('qtd-translado').textContent = t;
            document.getElementById('val-alimentacao').textContent = f(vA, 'R$ ');
            document.getElementById('val-pousada').textContent = f(vP, 'R$ ');
            document.getElementById('val-translado').textContent = f(vT, 'R$ ');
            document.getElementById('total-alimentacao').textContent = f(tA, 'R$ ');
            document.getElementById('total-pousada').textContent = f(tP, 'R$ ');
            document.getElementById('total-translado').textContent = f(tT, 'R$ ');
            document.getElementById('total-geral').textContent = f(tG, 'R$ ');
            atualizarPreview();
        }
        
        async function calcularValoresInternacionais() {
            if (!document.getElementById('grupo-internacional')) return; 
            await fetchHoraAtual(); 
            const g = document.getElementById('grupo-internacional').value, pg = document.getElementById('pais-grupo').value;
            const d = parseInt(document.getElementById('diarias-completas-int').value) || 0;
            const t = parseInt(document.getElementById('translados-int').value) || 0;
            let vDiariaUSD = 0;
            const vT_BRL = configValores.translado_internacional || 44.90;
            if (g && pg && valoresInternacionais[pg] && valoresInternacionais[pg][g]) { vDiariaUSD = valoresInternacionais[pg][g].diaria; }
            const tDiaria_BRL = (d * vDiariaUSD) * dolarRate;
            const tT_BRL = t * vT_BRL;
            const tG_BRL = tDiaria_BRL + tT_BRL;
            const f = (n, c = '') => `${c}${n.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('val-diaria-usd').textContent = f(vDiariaUSD, '$ ');
            document.getElementById('qtd-diaria-int').textContent = d;
            document.getElementById('total-diaria-int-brl').textContent = f(tDiaria_BRL, 'R$ ');
            document.getElementById('val-translado-int').textContent = f(vT_BRL, 'R$ ');
            document.getElementById('qtd-translado-int').textContent = t;
            document.getElementById('total-translado-int-tbl').textContent = f(tT_BRL, 'R$ ');
            document.getElementById('total-geral-int-tbl').textContent = f(tG_BRL, 'R$ ');
            document.getElementById('timestamp-int').textContent = timestampCalculo;
            atualizarPreview();
        }

        function atualizarPreview() {
            const infoCard = document.getElementById('info-solicitacao-card');
            const previewDadosViajante = document.getElementById('preview-dados-viajante');
            if (infoCard.style.display !== 'none') {
                previewDadosViajante.style.display = 'block';
                document.getElementById('preview-simulador-nome').textContent = document.getElementById('simulador-nome').value || '...';
                document.getElementById('preview-viajante-nome').textContent = document.getElementById('viajante-nome').value || '...';
                document.getElementById('preview-viajante-id').textContent = document.getElementById('viajante-id').value || '...';
                const banco = document.getElementById('viajante-banco').value;
                const agencia = document.getElementById('viajante-agencia').value;
                const conta = document.getElementById('viajante-conta').value;
                document.getElementById('preview-dados-bancarios').textContent = (banco || agencia || conta) ? `${banco} | Ag: ${agencia} | CC: ${conta}` : '...';
            } else {
                previewDadosViajante.style.display = 'none';
            }
            const isNacional = document.getElementById('nacional').classList.contains('active');
            document.getElementById('label-alimentacao').style.display = isNacional ? 'block' : 'none';
            document.getElementById('preview-total-alimentacao').style.display = isNacional ? 'block' : 'none';
            document.getElementById('label-pousada').style.display = isNacional ? 'block' : 'none';
            document.getElementById('preview-total-pousada').style.display = isNacional ? 'block' : 'none';
            document.getElementById('label-diaria-int').style.display = isNacional ? 'none' : 'block';
            document.getElementById('preview-total-diaria-int').style.display = isNacional ? 'none' : 'block';
            document.getElementById('label-cotacao').style.display = isNacional ? 'none' : 'block';
            document.getElementById('preview-cotacao').style.display = isNacional ? 'none' : 'block';
            document.getElementById('label-data-calculo').style.display = isNacional ? 'none' : 'block';
            document.getElementById('preview-data-calculo').style.display = isNacional ? 'none' : 'block';
            if (isNacional) {
                if(!document.getElementById('grupo')) return;
                document.getElementById('preview-tipo-viagem').textContent = 'Nacional';
                const grupoSelect = document.getElementById('grupo');
                const cidadeSelect = document.getElementById('cidade');
                document.getElementById('preview-grupo').textContent = grupoSelect.value ? grupoSelect.options[grupoSelect.selectedIndex].text : '...';
                document.getElementById('preview-localidade').textContent = cidadeSelect.value ? cidadeSelect.options[cidadeSelect.selectedIndex].text : '...';
                document.getElementById('preview-total-alimentacao').textContent = document.getElementById('total-alimentacao').textContent;
                document.getElementById('preview-total-pousada').textContent = document.getElementById('total-pousada').textContent;
                document.getElementById('preview-total-translado').textContent = document.getElementById('total-translado').textContent;
                document.getElementById('preview-total-geral').textContent = document.getElementById('total-geral').textContent;
            } else {
                if(!document.getElementById('grupo-internacional')) return;
                document.getElementById('preview-tipo-viagem').textContent = 'Internacional';
                const grupoSelect = document.getElementById('grupo-internacional');
                const paisSelect = document.getElementById('pais-grupo');
                document.getElementById('preview-grupo').textContent = grupoSelect.value ? grupoSelect.options[grupoSelect.selectedIndex].text : '...';
                document.getElementById('preview-localidade').textContent = paisSelect.value ? paisSelect.options[paisSelect.selectedIndex].text : '...';
                document.getElementById('preview-cotacao').textContent = document.getElementById('dolar-value').textContent;
                document.getElementById('preview-data-calculo').textContent = timestampCalculo;
                document.getElementById('preview-total-diaria-int').textContent = document.getElementById('total-diaria-int-brl').textContent;
                document.getElementById('preview-total-translado').textContent = document.getElementById('total-translado-int-tbl').textContent;
                document.getElementById('preview-total-geral').textContent = document.getElementById('total-geral-int-tbl').textContent;
            }
        }
        
        function gerarTXT() {
            const element = document.getElementById('preview-to-export');
            const viajanteNome = document.getElementById('viajante-nome').value || 'relatorio';
            let textContent = `RELATÓRIO DE CÁLCULO DE DIÁRIA\n====================================\n\n`;
            const sections = element.querySelectorAll('h4');
            const grids = element.querySelectorAll('.preview-grid');
            sections.forEach((section, index) => {
                if (section.parentElement.style.display === 'none') return;
                textContent += `${section.textContent.toUpperCase()}\n------------------------------------\n`;
                const items = grids[index].querySelectorAll('strong');
                const values = grids[index].querySelectorAll('span');
                items.forEach((item, i) => {
                    if (item.style.display !== 'none') { textContent += `${item.textContent} ${values[i].textContent}\n`; }
                });
                textContent += '\n';
            });
            const a = document.createElement('a');
            const file = new Blob([textContent], {type: 'text/plain;charset=utf-8'});
            a.href = URL.createObjectURL(file);
            a.download = `Calculo_Diaria_${viajanteNome.replace(/ /g, '_')}.txt`;
            a.click();
            URL.revokeObjectURL(a.href);
        }
        function imprimirPreview() { window.print(); }
        
        function renderizarCalculadoraNacional() {
            document.getElementById('calculator-nac-body').innerHTML = `
                <div class="grid">
                    <div>
                        <div class="form-group"><label for="grupo">Grupo</label><select id="grupo"><option value="">Selecione</option><option value="I">Grupo I</option><option value="II">Grupo II</option><option value="III">Grupo III</option></select></div>
                        <div class="form-group">
                            <label for="cidade">Cidade</label>
                            <select id="cidade">
                                <option value="">Selecione</option>
                                <option value="BrasiliaManaus">Brasília e Manaus</option>
                                <optgroup label="Capitais Principais"><option value="Capitais">Belém</option><option value="Capitais">Belo Horizonte</option><option value="Capitais">Fortaleza</option><option value="Capitais">Porto Alegre</option><option value="Capitais">Recife</option><option value="Capitais">Salvador</option><option value="Capitais">São Paulo</option></optgroup>
                                <option value="Demais">Demais Capitais e Cidades com mais de 200.000 habitantes</option>
                                <option value="Outras">Outras Cidades</option>
                            </select>
                            <span class="help-text">Para capitais não listadas, use "Demais Capitais e Cidades".</span>
                        </div>
                        <div class="form-group"><label for="diarias">Diárias (Alimentação)</label><input type="number" id="diarias" min="0" value="0"></div>
                        <div class="form-group"><label for="pernoites">Pernoites (Pousada)</label><input type="number" id="pernoites" min="0" value="0"></div>
                        <div class="form-group"><label for="translados">Translados</label><input type="number" id="translados" min="0" value="0"></div>
                    </div>
                    <div>
                        <div class="card-header"><i class="fas fa-chart-bar"></i>Resultados</div>
                        <table>
                            <thead><tr><th>Descrição</th><th>Valor Unitário (R$)</th><th>Quantidade</th><th>Total (R$)</th></tr></thead>
                            <tbody>
                                <tr><td>Alimentação</td><td id="val-alimentacao">R$ 0,00</td><td id="qtd-alimentacao">0</td><td id="total-alimentacao">R$ 0,00</td></tr>
                                <tr><td>Pousada</td><td id="val-pousada">R$ 0,00</td><td id="qtd-pousada">0</td><td id="total-pousada">R$ 0,00</td></tr>
                                <tr><td>Translado</td><td id="val-translado">R$ 44,00</td><td id="qtd-translado">0</td><td id="total-translado">R$ 0,00</td></tr>
                                <tr class="total-row"><td colspan="3"><strong>Total Geral:</strong></td><td id="total-geral">R$ 0,00</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>`;
            ['grupo', 'cidade', 'diarias', 'pernoites', 'translados'].forEach(id => document.getElementById(id).addEventListener('input', calcularValoresNacionais));
        }
        function renderizarCalculadoraInternacional() {
            document.getElementById('calculator-int-body').innerHTML = `
                <div class="grid">
                    <div>
                        <div class="form-group"><label for="grupo-internacional">Grupo</label><select id="grupo-internacional"><option value="">Selecione</option><option value="I">Grupo I</option><option value="II">Grupo II</option><option value="III">Grupo III</option></select></div>
                        <div class="form-group">
                            <label class="label-with-icon"><span>Grupo de Países</span><i class="fas fa-globe-americas info-icon" id="paises-info-btn" title="Ver lista de países"></i></label>
                            <select id="pais-grupo"><option value="">Selecione</option><option value="grupoA">Grupo A</option><option value="grupoB">Grupo B</option><option value="grupoC">Grupo C</option><option value="grupoD">Grupo D</option></select>
                        </div>
                        <div class="form-group"><label for="diarias-completas-int">Diárias Completas (Alim. + Pousada)</label><input type="number" id="diarias-completas-int" min="0" value="0"></div>
                        <div class="form-group"><label for="translados-int">Translados</label><input type="number" id="translados-int" min="0" value="0"></div>
                    </div>
                    <div>
                        <div class="card-header"><i class="fas fa-chart-bar"></i>Resultados</div>
                        <table>
                            <thead><tr><th>Descrição</th><th>Valor Unitário</th><th>Quantidade</th><th>Total (BRL)</th></tr></thead>
                            <tbody>
                                <tr><td>Diária Completa</td><td id="val-diaria-usd">$ 0,00</td><td id="qtd-diaria-int">0</td><td id="total-diaria-int-brl">R$ 0,00</td></tr>
                                <tr><td>Translado</td><td id="val-translado-int">R$ 44,90</td><td id="qtd-translado-int">0</td><td id="total-translado-int-tbl">R$ 0,00</td></tr>
                                <tr class="total-row"><td colspan="3"><strong>Total Geral (BRL):</strong></td><td id="total-geral-int-tbl">R$ 0,00</td></tr>
                            </tbody>
                        </table>
                        <p style="font-size:12px; text-align:right; color: #6c757d; margin-top:10px;">Cálculo realizado em: <span id="timestamp-int">--</span></p>
                    </div>
                </div>`;
            ['grupo-internacional', 'pais-grupo', 'diarias-completas-int', 'translados-int'].forEach(id => document.getElementById(id).addEventListener('input', calcularValoresInternacionais));
        }
        function renderizarModalPaises() {
            let html = `<div class="modal-overlay" id="paises-modal"><div class="modal-container">
                <div class="modal-header"><h2>Grupos de Países</h2><button type="button" class="modal-close-btn">&times;</button></div>
                <div class="modal-body">
                    <input type="search" id="search-paises" placeholder="Pesquisar país..." style="margin-bottom: 20px;">
                    <div class="paises-grid">
                        <div class="paises-group"><h4>Grupo A</h4><div class="paises-list"><span>Afeganistão</span><span>Armênia</span><span>Bangladesh</span><span>Belarus</span><span>Bolívia</span><span>Benin</span><span>Burkina-Fasso</span><span>Butão</span><span>Comores</span><span>República Popular Democrática da Coréia</span><span>Costa Rica</span><span>El Salvador</span><span>Equador</span><span>Eslovênia</span><span>Filipinas</span><span>Gâmbia</span><span>Guiana</span><span>Guiné Bissau</span><span>Guiné</span><span>Honduras</span><span>Indonésia</span><span>Irã</span><span>Iraque</span><span>Laos</span><span>Líbano</span><span>Malásia</span><span>Maldivas</span><span>Marrocos</span><span>Mongólia</span><span>Myanmar</span><span>Namíbia</span><span>Nauru</span><span>Nepal</span><span>Nicarágua</span><span>Panamá</span><span>Paraguai</span><span>Rep. Centro Africana</span><span>República Togolesa</span><span>Salomão</span><span>Samoa</span><span>Seychelles</span><span>Serra Leoa</span><span>Síria</span><span>Somália</span><span>Sri Lanka</span><span>Suazilândia</span><span>Suriname</span><span>Tadjiquistão</span><span>Tailândia</span><span>Timor Leste</span><span>Tonga</span><span>Tunísia</span><span>Turcomenistão</span><span>Turquia</span><span>Tuvalu</span><span>Vanuatu</span><span>Vietnã</span><span>Zimbábue</span></div></div>
                        <div class="paises-group"><h4>Grupo B</h4><div class="paises-list"><span>África do Sul</span><span>Albânia</span><span>Andorra</span><span>Argélia</span><span>Austrália</span><span>Barbados</span><span>Belize</span><span>Bósnia-Herzegovina</span><span>Burundi</span><span>Cabo Verde</span><span>Camarões</span><span>Camboja</span><span>Chade</span><span>Chipre</span><span>Colômbia</span><span>Dominica</span><span>Egito</span><span>Eritréia</span><span>Etiópia</span><span>Gana</span><span>Geórgia</span><span>Granada</span><span>Guiné-Equatorial</span><span>Haiti</span><span>Hungria</span><span>lêmen</span><span>Ilhas Marshall</span><span>Índia</span><span>Kiribati</span><span>Kuwait</span><span>Lesoto</span><span>Líbia</span><span>Macedônia</span><span>Madagascar</span><span>Malauí</span><span>Micronésia</span><span>Moçambique</span><span>Moldávia</span><span>Níger</span><span>Nigéria</span><span>Nova Zelândia</span><span>Palau</span><span>Papua Nova Guiné</span><span>Paquistão</span><span>Polônia</span><span>Quênia</span><span>República Dominicana</span><span>República Eslovaca</span><span>Romênia</span><span>Ruanda</span><span>São Tomé e Príncipe</span><span>Senegal</span><span>Sudão</span><span>Tanzânia</span><span>Uruguai</span><span>Uzbequistão</span><span>Venezuela</span></div></div>
                        <div class="paises-group"><h4>Grupo C</h4><div class="paises-list"><span>Antígua e Barbuda</span><span>Arábia Saudita</span><span>Argentina</span><span>Azerbaijão</span><span>Bahamas</span><span>Bahrein</span><span>Brunei Darussalam</span><span>Botswana</span><span>Bulgária</span><span>Canadá</span><span>Chile</span><span>Cingapura</span><span>Congo</span><span>Costa do Marfim</span><span>Cuba</span><span>Djibuti</span><span>Fiji</span><span>Gabão</span><span>Guatemala</span><span>Jamaica</span><span>Jordânia</span><span>Letônia</span><span>Libéria</span><span>Lituânia</span><span>Mali</span><span>Malta</span><span>Maurício</span><span>Mauritânia</span><span>México</span><span>Peru</span><span>República Democrática do Congo</span><span>República Tcheca</span><span>Rússia</span><span>San Marino</span><span>Santa Lúcia</span><span>São Cristóvão e Névis</span><span>São Vicente e Granadinas</span><span>Taiwan</span><span>Trinidad e Tobago</span><span>Ucrânia</span><span>Uganda</span><span>Zâmbia</span></div></div>
                        <div class="paises-group"><h4>Grupo D</h4><div class="paises-list"><span>Alemanha</span><span>Angola</span><span>Áustria</span><span>Bélgica</span><span>Catar</span><span>Cazaquistão</span><span>China</span><span>Coréia do Sul</span><span>Croácia</span><span>Dinamarca</span><span>Emirados Árabes</span><span>Espanha</span><span>Estados Unidos da América</span><span>Estônia</span><span>Finlândia</span><span>França</span><span>Grécia</span><span>Hong Kong</span><span>Irlanda</span><span>Islândia</span><span>Israel</span><span>Itália</span><span>Japão</span><span>Liechtenstein</span><span>Luxemburgo</span><span>Mônaco</span><span>Montenegro</span><span>Noruega</span><span>Omã</span><span>Países Baixos</span><span>Portugal</span><span>Reino Unido</span><span>República Quirguiz</span><span>Sérvia</span><span>Suécia</span><span>Suíça</span></div></div>
                    </div>
                </div>
            </div></div>`;
            document.getElementById('paises-modal-container').innerHTML = html;
        }
        
        function toggleInfoPanel() {
            const infoCard = document.getElementById('info-solicitacao-card');
            const btn = document.getElementById('toggle-info-btn');
            const isHidden = infoCard.style.display === 'none';
            if (isHidden) {
                infoCard.style.display = 'block';
                btn.innerHTML = `<i class="fas fa-user-minus"></i> Ocultar Info.`;
                btn.style.backgroundColor = 'var(--laranja)';
            } else {
                infoCard.style.display = 'none';
                btn.innerHTML = `<i class="fas fa-user-plus"></i> Adicionar Info.`;
                btn.style.backgroundColor = 'var(--cinza-escuro)';
            }
            atualizarPreview();
        }

        function filtrarPaises() {
            const termo = document.getElementById('search-paises').value.toLowerCase();
            const paises = document.querySelectorAll('.paises-list span');
            paises.forEach(pais => {
                const nomePais = pais.textContent.toLowerCase();
                if (nomePais.includes(termo)) {
                    pais.style.display = 'block';
                } else {
                    pais.style.display = 'none';
                }
            });
        }

        window.onload = async function() {
            renderizarCalculadoraNacional();
            renderizarCalculadoraInternacional();
            renderizarModalPaises();
            
            await carregarTodosOsValores();
            await fetchDolarRate();
            
            calcularValoresNacionais();
            calcularValoresInternacionais();
            atualizarPreview();

            ['simulador-nome', 'viajante-nome', 'viajante-id', 'viajante-banco', 'viajante-agencia', 'viajante-conta'].forEach(id => {
                document.getElementById(id).addEventListener('input', atualizarPreview);
            });
            document.getElementById('toggle-info-btn').addEventListener('click', toggleInfoPanel);

            const paisesModal = document.getElementById('paises-modal');
            document.getElementById('paises-info-btn').addEventListener('click', () => paisesModal.classList.add('active'));
            paisesModal.querySelector('.modal-close-btn').addEventListener('click', () => paisesModal.classList.remove('active'));
            document.getElementById('search-paises').addEventListener('keyup', filtrarPaises);
        };
    </script>
</body>
</html>